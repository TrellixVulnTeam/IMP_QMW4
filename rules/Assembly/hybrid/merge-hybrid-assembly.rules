rule collapse_hybrid_assemblies:
    input:
        'Assembly/mgmt.megahit_hybrid.1.fa',
        'Assembly/mgmt.megahit_hybrid.2.fa',
    output:
        'Assembly/mgmt.assembly.merged.fa'
    shell:
        """
        NAME=Assembly/mgmt.assembly
        cat {input} > $NAME.cat.fa

        # Options should be after input file!
        cap3 $NAME.cat.fa -p 98 -o 100

        # Concatenate assembled contigs, singletons and rename the contigs
        cat $NAME.cat.fa.cap.contigs $NAME.cat.fa.cap.singlets | \
        awk '/^>/{{print \">contig_\" ++i; next}}{{print}}' > $NAME.merged.fa
        """
